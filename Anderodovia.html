<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Midnight Drive 3D - Fiel à Foto</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', Courier, monospace; }
        #ui { position: absolute; top: 20px; width: 100%; text-align: center; color: #00ff00; font-size: 30px; pointer-events: none; text-shadow: 2px 2px #000; }
        #controles { position: absolute; bottom: 10px; width: 100%; text-align: center; color: white; font-size: 12px; opacity: 0.5; }
    </style>
</head>
<body>
    <div id="ui">SCORE: <span id="score">0</span></div>
    <div id="controles">PC: SETAS | MOBILE: TOQUE LATERAIS</div>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000);
        scene.fog = new THREE.Fog(0x000000, 20, 100);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // --- AMBIENTE (ESTRADA E GRAMA) ---
        const worldGroup = new THREE.Group();
        scene.add(worldGroup);

        function createFloor() {
            const planeGeo = new THREE.PlaneGeometry(100, 200);
            const planeMat = new THREE.MeshPhongMaterial({ color: 0x003300 }); // Grama verde escuro
            const floor = new THREE.Mesh(planeGeo, planeMat);
            floor.rotation.x = -Math.PI / 2;
            worldGroup.add(floor);

            // Asfalto
            const roadGeo = new THREE.PlaneGeometry(14, 200);
            const roadMat = new THREE.MeshPhongMaterial({ color: 0x222222 });
            const road = new THREE.Mesh(roadGeo, roadMat);
            road.position.y = 0.01;
            floor.add(road);

            // Faixas centrais azuis (detalhe da sua foto)
            const blueLineGeo = new THREE.PlaneGeometry(0.3, 200);
            const blueLineMat = new THREE.MeshBasicMaterial({ color: 0x0000ff });
            const line1 = new THREE.Mesh(blueLineGeo, blueLineMat);
            line1.position.set(-0.5, 0.02, 0);
            floor.add(line1);
            const line2 = new THREE.Mesh(blueLineGeo, blueLineMat);
            line2.position.set(0.5, 0.02, 0);
            floor.add(line2);
            
            // Faixas brancas pontilhadas
            for(let i = -100; i < 100; i += 10) {
                const stripeGeo = new THREE.PlaneGeometry(0.5, 5);
                const stripeMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
                const s = new THREE.Mesh(stripeGeo, stripeMat);
                s.position.set(0, 0.03, i);
                floor.add(s);
            }
        }
        createFloor();

        // --- POSTES DE LUZ (IGUAL À FOTO) ---
        function createStreetLight(z) {
            const pole = new THREE.Group();
            const stick = new THREE.Mesh(new THREE.BoxGeometry(0.2, 8, 0.2), new THREE.MeshPhongMaterial({color: 0x555555}));
            stick.position.y = 4;
            pole.add(stick);

            const arm = new THREE.Mesh(new THREE.BoxGeometry(2, 0.2, 0.2), new THREE.MeshPhongMaterial({color: 0x555555}));
            arm.position.set(-1, 8, 0);
            pole.add(arm);

            const light = new THREE.PointLight(0xffffaa, 5, 15);
            light.position.set(-2, 7.5, 0);
            pole.add(light);

            pole.position.set(8, 0, z);
            worldGroup.add(pole);
        }

        for(let i = 0; i > -200; i -= 30) {
            createStreetLight(i);
            createStreetLight(i + 15);
        }

        // --- JOGADOR (CARRO AZUL) ---
        const player = new THREE.Group();
        const carBody = new THREE.Mesh(new THREE.BoxGeometry(1.2, 0.7, 2.2), new THREE.MeshPhongMaterial({color: 0x00ccff}));
        carBody.position.y = 0.5;
        player.add(carBody);
        scene.add(player);
        player.position.set(-3, 0, 10);

        // --- INIMIGOS E OBSTÁCULOS ---
        const obstacles = [];
        function spawnEnemy() {
            const isBus = Math.random() > 0.7;
            const color = isBus ? 0xff0000 : (Math.random() > 0.5 ? 0xffff00 : 0xff00ff);
            const geo = isBus ? new THREE.BoxGeometry(1.5, 1.5, 5) : new THREE.BoxGeometry(1.2, 0.7, 2.2);
            const mesh = new THREE.Mesh(geo, new THREE.MeshPhongMaterial({color: color}));
            
            const lane = (Math.floor(Math.random() * 2) === 0) ? -3.5 : 3.5;
            mesh.position.set(lane, isBus ? 0.75 : 0.5, -80);
            scene.add(mesh);
            obstacles.push(mesh);
        }

        // --- LÓGICA ---
        let score = 0;
        let speed = 0.8;
        const keys = { left: false, right: false };

        window.onkeydown = (e) => { 
            if(e.code == "ArrowLeft") keys.left = true;
            if(e.code == "ArrowRight") keys.right = true;
        };
        window.onkeyup = (e) => { 
            if(e.code == "ArrowLeft") keys.left = false;
            if(e.code == "ArrowRight") keys.right = false;
        };

        // Mobile
        window.ontouchstart = (e) => {
            if(e.touches[0].clientX < window.innerWidth/2) keys.left = true;
            else keys.right = true;
        };
        window.ontouchend = () => { keys.left = false; keys.right = false; };

        function update() {
            requestAnimationFrame(update);

            // Movimento do mundo (Loop infinito)
            worldGroup.position.z += speed;
            if(worldGroup.position.z > 50) worldGroup.position.z = 0;

            // Movimento Jogador
            if(keys.left && player.position.x > -5) player.position.x -= 0.2;
            if(keys.right && player.position.x < 5) player.position.x += 0.2;

            // Obstáculos
            if(Math.random() < 0.03) spawnEnemy();
            
            obstacles.forEach((obj, i) => {
                obj.position.z += speed;
                
                // Colisão
                const
