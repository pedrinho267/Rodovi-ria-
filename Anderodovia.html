<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Perigo nas Bordas - Velocity 1</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: #5db9ff; overflow: hidden; font-family: 'Arial Black', sans-serif; touch-action: none; }
        canvas { display: block; width: 100vw; height: 100vh; }
        
        #hud { 
            position: absolute; top: 15px; left: 15px; color: #fff; 
            font-size: 14px; z-index: 10; text-shadow: 2px 2px #000;
        }

        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); display: flex; flex-direction: column;
            justify-content: center; align-items: center; color: white; z-index: 30;
        }

        #menu h1 { color: #fff; font-size: 2rem; margin-bottom: 5px; }
        #menu p { color: #eee; margin-bottom: 20px; }

        button {
            background: #8bc34a; border: none; padding: 12px 40px;
            font-size: 20px; color: white; border-radius: 8px; font-weight: bold;
            cursor: pointer; box-shadow: 0 4px #689f38;
        }
        button:active { transform: translateY(2px); box-shadow: 0 2px #689f38; }

        /* Botões de Controle iguais à imagem */
        #controls {
            position: absolute; bottom: 30px; width: 100%;
            display: flex; justify-content: space-between; padding: 0 30px; z-index: 20;
        }
        .btn {
            width: 75px; height: 75px; background: rgba(255,255,255,0.4);
            border-radius: 50%; border: 4px solid #fff; display: flex;
            justify-content: center; align-items: center; font-size: 40px;
            color: #333; user-select: none;
        }
    </style>
</head>
<body>

<div id="hud">KM: 0<br>DISTÂNCIA: 0m</div>

<div id="menu" class="overlay">
    <h1>PERIGO NAS BORDAS!</h1>
    <p>Carros vermelhos surgem nas laterais.</p>
    <button onclick="startGame()">INICIAR</button>
</div>

<div id="game-over" class="overlay" style="display:none;">
    <h1 style="color: #ff3b3b;">COLIDIU!</h1>
    <button onclick="startGame()">TENTAR DE NOVO</button>
</div>

<div id="controls">
    <div class="btn" id="lBtn">←</div>
    <div class="btn" id="rBtn">→</div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const hud = document.getElementById('hud');
const menu = document.getElementById('menu');
const gameOver = document.getElementById('game-over');

let width, height, horizon;
let carX = 0; 
let roadZ = 0;
let score = 0;
let isRunning = false;
let obstacles = [];

const SPEED = 1; 
const LATERAL_SPEED = 0.025;

function resize() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
    horizon = height * 0.45;
}
window.onresize = resize;
resize();

// Inputs
const input = { left: false, right: false };
const setupBtn = (id, key) => {
    const el = document.getElementById(id);
    const start = (e) => { e.preventDefault(); input[key] = true; };
    const end = () => input[key] = false;
    el.ontouchstart = start; el.ontouchend = end;
    el.onmousedown = start; el.onmouseup = end;
};
setupBtn('lBtn', 'left'); setupBtn('rBtn', 'right');

function startGame() {
    score = 0; carX = 0; roadZ = 0; obstacles = [];
    isRunning = true;
    menu.style.display = 'none';
    gameOver.style.display = 'none';
    animate();
}

function spawnObstacle() {
    if (Math.random() < 0.015) {
        let type = Math.random() > 0.5 ? 'red' : 'yellow';
        let posX;
        
        if (type === 'red') {
            // Carros vermelhos: Spawnam nos cantos (esquerda -0.8 ou direita 0.8)
            posX = Math.random() > 0.5 ? -0.85 : 0.85;
        } else {
            // Carros amarelos: Spawnam mais pro meio
            posX = (Math.random() * 0.6) - 0.3;
        }

        obstacles.push({ z: 1000, x: posX, color: type === 'red' ? '#ff3b3b' : '#ffeb3b' });
    }
}

function animate() {
    if (!isRunning) return;
    
    roadZ += SPEED;
    score += 0.1;
    hud.innerHTML = `KM: ${Math.floor(score/10)}<br>DISTÂNCIA: ${Math.floor(score)}m`;

    if (input.left) carX -= LATERAL_SPEED;
    if (input.right) carX += LATERAL_SPEED;
    carX = Math.max(-0.9, Math.min(0.9, carX));

    spawnObstacle();
    draw();
    requestAnimationFrame(animate);
}

function draw() {
    // Céu
    ctx.fillStyle = "#5db9ff"; ctx.fillRect(0,0,width,horizon);
    // Grama
    ctx.fillStyle = "#69b522"; ctx.fillRect(0,horizon,width,height-horizon);

    // Estrada
    ctx.fillStyle = "#333";
    ctx.beginPath();
    ctx.moveTo(width/2 - 20, horizon); ctx.lineTo(width/2 + 20, horizon);
    ctx.lineTo(width * 1.5, height); ctx.lineTo(width * -0.5, height);
    ctx.fill();

    // Faixas brancas laterais
    ctx.strokeStyle = "#fff"; ctx.lineWidth = 6;
    ctx.beginPath();
    ctx.moveTo(width/2 - 25, horizon); ctx.lineTo(width * -0.2, height);
    ctx.moveTo(width/2 + 25, horizon); ctx.lineTo(width * 1.2, height);
    ctx.stroke();

    // Faixa central amarela
    ctx.strokeStyle = "#ffeb3b"; ctx.setLineDash([30, 60]);
    ctx.lineDashOffset = -roadZ * 2.5;
    ctx.beginPath(); ctx.moveTo(width/2, horizon); ctx.lineTo(width/2, height); ctx.stroke();
    ctx.setLineDash([]);

    // Obstáculos
    obstacles.sort((a,b) => b.z - a.z);
    for (let i = obstacles.length - 1; i >= 0; i--) {
        let o = obstacles[i];
        o.z -= SPEED;
        if (o.z < 1) { obstacles.splice(i, 1); continue; }

        let scale = 30 / o.z;
        let x = width/2 + o.x * scale * (width * 0.6);
        let y = horizon + scale * (height * 0.6);
        let size = scale * 130;

        ctx.fillStyle = o.color;
        ctx.fillRect(x - size/2, y - size/3, size, size/2.5);
        
        // Detalhes (Janelas)
        ctx.fillStyle = "rgba(255,255,255,0.3)";
        ctx.fillRect(x - size/2 + 5, y - size/3 + 5, size - 10, size/10);

        // Colisão (O carro do jogador está fixo no PX)
        if (o.z < 50 && o.z > 10) {
            let pX = (width/2) + (carX * (width * 0.5));
            if (Math.abs(x - pX) < size * 0.8) {
                isRunning = false;
                gameOver.style.display = 'flex';
            }
        }
    }

    // Carro Azul (Jogador)
    let pSize = width > 500 ? 100 : 70;
    let px = (width/2) + (carX * (width * 0.5));
    let py = height - 100;

    ctx.fillStyle = "#2196f3";
    ctx.fillRect(px - pSize/2, py, pSize, pSize/2.5);
    ctx.fillStyle = "#0d47a1"; // Vidro
    ctx.fillRect(px - pSize/2 + 10, py + 5, pSize - 20, pSize/10);
}
</script>
</body>
</html>
